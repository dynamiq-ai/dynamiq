connections:
  anthropic-conn:
    type: dynamiq.connections.Anthropic
    api_key: ${oc.env:ANTHROPIC_API_KEY}
  e2b-conn:
    type: dynamiq.connections.E2B
    api_key: ${oc.env:E2B_API_KEY}
  dynamiq-api-conn:
    type: dynamiq.connections.Dynamiq
    url: ${oc.env:DYNAMIQ_URL}
    api_key: ${oc.env:DYNAMIQ_API_KEY}

nodes:
  registry-skills-agent:
    type: dynamiq.nodes.agents.Agent
    llm:
      id: registry-skills-agent-llm
      type: dynamiq.nodes.llms.Anthropic
      connection: anthropic-conn
      model: claude-sonnet-4-6
      max_tokens: 32000
    tools: []
    role: |
      You have access to skills (SkillsTool) and a sandbox. For every task you must:
      1. Use SkillsTool with action="list" to see available skills, then action="get" with skill_name="..." to load the skill(s) needed for the deliverable.
      2. Map deliverables to skills: Word / .docx → docx; PDF → pdf; PowerPoint / .pptx → pptx; Excel / .xlsx → xlsx; Markdown/HTML → md; landing page / web UI / frontend → frontend-design; React/shadcn multi-component artifact → web-artifacts-builder; poster / visual art / canvas → canvas-design. For multiple types, get each relevant skill.
      3. When get returns "scripts_path", run scripts in the sandbox at that path (e.g. /home/user/skills/docx/scripts/, .../web-artifacts-builder/scripts/). Use the sandbox tool for shell or Python. For web-artifacts-builder use init-artifact.sh and bundle-artifact.sh. The md and frontend-design skills may have no scripts; follow skill instructions.
      4. Write all output files to /home/user/output so they are collected. Uploaded files from the user go to /home/user/input.
      5. Web app / website tasks (e.g. recreate a marketing site like getdynamiq.ai): Use frontend-design for a single-page HTML/CSS/JS site, or web-artifacts-builder for a React/shadcn multi-component app. Include hero, value propositions, feature sections, and footer as appropriate. Output must have a proper structure: use folders and subfolders as needed (e.g. index.html, css/, js/, assets/, images/)—not only a single file. Save the full artifact tree to /home/user/output (all files and folders so they are collected). Optionally also create a zip archive of the artifact (e.g. zip -r artifact.zip . from the project root) and place the zip in /home/user/output for a single downloadable bundle. If the task asks for a "live" or "viewable" link: start the dev server in the background (sandbox shell with run_in_background_enabled=true, e.g. npm run dev or npx vite), then call SandboxInfoTool with that port (e.g. 5173) to get the public URL, and include that URL clearly in your final answer (e.g. "Preview URL: https://..."). Otherwise deliver the static files (and zip if created) for local viewing.
      Skills available (when registered): docx, pdf, pptx, xlsx, md, frontend-design, web-artifacts-builder, canvas-design. Do not mention skills or paths in the user-facing reply; just accomplish the task and save outputs to the output directory.
    sandbox:
      enabled: true
      backend:
        type: dynamiq.sandboxes.E2BSandbox
        connection: e2b-conn
    skills:
      enabled: true
      source:
        type: dynamiq.skills.registries.Dynamiq
        connection: dynamiq-api-conn
        sandbox_skills_base_path: "/home/user/skills"
        # Skill and version IDs from scripts/local_skill_upload_download_test.py (--local-skill-dir .skills/<dir>).
        # canvas-design: skill id a4943152-5e66-4f38-8415-e69543f9712c created but version upload failed (400 Limit 1048576). Add entry when a version is uploaded.
        skills:
          - id: "afc2c23a-5cc0-481f-b449-c272848b4f08"
            version_id: "ed5a7f9a-4a6c-44cd-92d5-6e59a6c1aea7"
            name: docx
            description: Create, read, edit, and manipulate Word documents (.docx); reports, memos, letters, templates; Markdown/HTML to docx via pandoc.
          - id: "edad02ad-4e5b-45b6-b19d-7fcabcdef0f1"
            version_id: "d6ae58d9-87ed-4106-8e74-850f073a031e"
            name: pdf
            description: PDF creation, form filling, extraction, conversion, and validation; Markdown/HTML to PDF via pandoc or docx→PDF.
          - id: "aec58f89-c457-4c9d-94bb-ade851303824"
            version_id: "cde7e1ed-abd6-4a9f-845e-2de7c3562a63"
            name: pptx
            description: Create, edit, and manipulate PowerPoint presentations (.pptx); design and QA rules, scripts for thumbnail, pack, soffice.
          - id: "d5dbb2be-880f-491c-8673-6cbe9416bc88"
            version_id: "a019dd3c-a2c7-49bf-a9ae-cda37bf02d2f"
            name: xlsx
            description: Create, edit, and manipulate Excel spreadsheets (.xlsx); formulas, recalc, dashboard and R-ready rules.
          - id: "b42f4bf0-9ceb-48ad-a76b-47ad00887ab9"
            version_id: "b073d1a2-e47a-42bc-b268-6ad4a750d152"
            name: md
            description: Markdown and HTML as source or target; convert md/html to or from docx, pdf, pptx using pandoc and markitdown.
          - id: "d3760c62-85f4-445b-a9d1-233950439cb2"
            version_id: "c8524465-7f03-4a90-8e53-7fa94e99b289"
            name: frontend-design
            description: Create distinctive, production-grade frontend interfaces; web components, pages, dashboards, HTML/CSS/JS or React; avoid generic AI aesthetics.
          - id: "dbb65cfd-4b28-4a9c-b104-7227bcec2883"
            version_id: "f141a783-e24c-42a1-a778-091d3ee21d4d"
            name: web-artifacts-builder
            description: React + TypeScript + Vite + Tailwind + shadcn/ui artifacts; init-artifact.sh, bundle-artifact.sh for single HTML artifact.
    max_loops: 100
    inference_mode: XML

flows:
  registry-skills-flow:
    name: Registry skills + E2B sandbox
    nodes:
      - registry-skills-agent

workflows:
  registry-skills-sandbox-workflow:
    flow: registry-skills-flow
    version: 1
